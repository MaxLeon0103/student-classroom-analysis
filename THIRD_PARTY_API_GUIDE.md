# 第三方OpenAI API配置指南

## 🎯 概述

本系统已完全支持第三方OpenAI API提供商，如 [https://openai.linktre.cc](https://openai.linktre.cc)。通过配置第三方API，您可以享受更稳定的服务和更优惠的价格。

## 🔧 配置步骤

### 1. 环境变量配置

编辑 `.env` 文件，添加以下配置：

```env
# AI服务提供商
AI_PROVIDER=openai

# OpenAI配置
OPENAI_API_KEY=sk-xw0oWTC7WyTfI10_J4dkdy9qmCV4Mv8hrK7s6wrN8ocm2b0DSmYEMknVEB4
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=500
OPENAI_TEMPERATURE=0.7

# 第三方OpenAI API提供商配置
OPENAI_BASE_URL=https://openai.linktre.cc/v1
```

### 2. 验证配置

运行测试脚本验证API连接：

```bash
npm run test-api
```

### 3. 启动服务

```bash
npm start
```

## 📝 优化的提示词系统

### 核心改进

1. **课程内容紧密结合**：评价必须基于具体的课程内容和知识点
2. **具体化评价**：避免空泛的套话，基于实际课堂表现
3. **知识点导向**：明确指出学生在哪些知识点上表现良好或需要加强
4. **实例支撑**：引用学生在课堂中的具体表现

### 提示词示例

**主要提示词模板：**
```
作为一名专业的教育评价专家，请根据以下课堂内容和评价等级，生成一份具体、详细的学生课堂表现评价：

课堂内容：{content}
评价等级：{rating}

评价要求：
1. **必须紧密结合课程内容**：分析学生对本节课具体知识点的掌握情况
2. **具体化评价**：基于课堂中的具体表现、回答、互动等实际情况进行评价
3. **知识点导向**：明确指出学生在哪些知识点上表现良好，哪些需要加强
4. **实例支撑**：如果可能，引用学生在课堂中的具体表现作为评价依据

评价结构：
- 开头：简要总结学生在本节课的整体表现
- 主体：详细分析学生对具体知识点的掌握情况
  * 重点知识理解程度
  * 课堂互动参与情况
  * 问题回答质量
  * 学习态度表现
- 结尾：基于本节课内容给出具体的改进建议

语言要求：
- 专业且具体，避免空泛的套话
- 紧密结合课程内容，体现专业性
- 字数控制在250-350字之间
- 语调积极正面，鼓励学生进步
```

## 🎯 使用示例

### 输入示例

**课堂内容：**
```
本节课学习了数学中的二次函数，包括：
1. 二次函数的定义和一般形式 y=ax²+bx+c
2. 二次函数的图像特征（开口方向、顶点、对称轴）
3. 二次函数与一元二次方程的关系
4. 实际应用问题（如抛物线运动、最值问题等）

学生在课堂中表现积极，能够回答关于二次函数开口方向的问题，但在计算顶点坐标时出现了一些错误。
```

**评价等级：** 良好

### 期望输出

系统将生成类似以下的评价：

```
该学生在二次函数这节课中表现良好。在课堂开始时，能够准确回答关于二次函数开口方向的问题，显示出对基本概念的理解。在讨论y=ax²+bx+c一般形式时，学生积极参与，能够正确识别二次项系数a的作用。

然而，在计算顶点坐标的练习中，学生在使用公式(-b/2a, (4ac-b²)/4a)时出现了计算错误，特别是在处理负数和分数运算时。这表明学生对二次函数的基本概念掌握较好，但在具体计算技能上还需要加强练习。

建议学生在课后多练习二次函数顶点坐标的计算，特别关注负数和分数的运算规则。同时，可以尝试通过画图来验证计算结果，加深对二次函数图像特征的理解。
```

## 🔍 质量检查

### 评价质量指标

1. **相关性得分**：评价与课程内容的相关程度
2. **具体性**：是否包含具体的知识点和实例
3. **建设性**：是否提供具体的改进建议
4. **专业性**：语言是否专业且符合教育评价标准

### 测试命令

```bash
# 测试API连接和评价质量
npm run test-api

# 查看详细配置
npm run config
```

## 🛠️ 故障排除

### 常见问题

1. **API连接失败**
   - 检查API Key是否正确
   - 确认第三方API提供商服务状态
   - 验证网络连接

2. **评价质量不佳**
   - 检查提示词配置
   - 调整temperature参数
   - 增加max_tokens数量

3. **响应速度慢**
   - 检查网络延迟
   - 考虑更换API提供商
   - 调整超时设置

### 调试模式

启用详细日志：

```env
DEBUG=true
LOG_LEVEL=debug
```

## 📊 性能优化

### 参数调优建议

1. **Temperature设置**
   - 0.3-0.5：更稳定、一致的回答
   - 0.7-0.9：更有创造性、多样性的回答

2. **Max Tokens设置**
   - 300-400：适合简短评价
   - 500-600：适合详细评价

3. **模型选择**
   - gpt-3.5-turbo：性价比高，适合大多数场景
   - gpt-4：质量更高，适合复杂评价需求

## 🔒 安全注意事项

1. **API密钥保护**
   - 不要在代码中硬编码API密钥
   - 使用环境变量管理敏感信息
   - 定期轮换API密钥

2. **数据隐私**
   - 确保第三方API提供商符合数据保护要求
   - 避免传输敏感学生信息
   - 考虑数据本地化要求

## 📞 技术支持

如果遇到问题，可以：

1. 查看控制台错误日志
2. 运行测试脚本诊断问题
3. 检查第三方API提供商文档
4. 参考本文档的故障排除部分

---

**注意：** 使用第三方API提供商时，请确保遵守相关服务条款和使用限制。
